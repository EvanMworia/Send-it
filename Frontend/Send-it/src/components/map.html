<!DOCTYPE html>
<html>
<head>
    <title>Delivery Route Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 80%;
            margin: 20px auto;
            border-radius: 8px;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        .distance-info {
            text-align: center;
            font-size: 1.2em;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <input type="text" id="start" placeholder="Start Location (e.g., Nairobi)">
        <input type="text" id="end" placeholder="End Location (e.g., Mombasa)">
        <button onclick="calculateRoute()">Show Route</button>
    </div>
    <div id="map"></div>
    <div id="distance" class="distance-info"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        let map;
        let routePolyline;
        let startMarker;
        let endMarker;

        // Initialize map
        function initMap() {
            map = L.map('map').setView([-1.286389, 36.817223], 6); // Default to Nairobi
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
        }

        async function geocodeLocation(location) {
            const response = await fetch(
                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`
            );
            const data = await response.json();
            return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
        }

        async function getRoute(startCoords, endCoords) {
            const response = await fetch(
                `https://router.project-osrm.org/route/v1/driving/${startCoords[1]},${startCoords[0]};${endCoords[1]},${endCoords[0]}?overview=full&geometries=geojson`
            );
            const data = await response.json();
            return {
                coordinates: data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]),
                distance: (data.routes[0].distance / 1000).toFixed(2)
            };
        }

        async function calculateRoute() {
            const startLocation = document.getElementById('start').value;
            const endLocation = document.getElementById('end').value;

            try {
                // Clear previous markers and route
                if (routePolyline) map.removeLayer(routePolyline);
                if (startMarker) map.removeLayer(startMarker);
                if (endMarker) map.removeLayer(endMarker);

                // Geocode locations
                const startCoords = await geocodeLocation(startLocation);
                const endCoords = await geocodeLocation(endLocation);

                // Get route data
                const route = await getRoute(startCoords, endCoords);

                // Update map view
                map.setView(startCoords, 7);

                // Add markers
                startMarker = L.marker(startCoords)
                    .addTo(map)
                    .bindPopup(startLocation);
                
                endMarker = L.marker(endCoords)
                    .addTo(map)
                    .bindPopup(endLocation);

                // Draw route
                routePolyline = L.polyline(route.coordinates, {color: 'blue'})
                    .addTo(map);

                // Update distance display
                document.getElementById('distance').innerHTML = 
                    `Distance: ${route.distance} km`;

            } catch (error) {
                console.error('Error:', error);
                alert('Error calculating route. Please check the locations and try again.');
            }
        }

        // Initialize the map when page loads
        window.onload = initMap;
    </script>
</body>
</html>